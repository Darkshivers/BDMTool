<html>

<title>BDM Customer Point Viewer (beta)</title> 

<script type="text/javascript" src="tvcheck.js"></script>

<link rel="stylesheet" type="text/css" href="style.css">
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script> 


function myFunction() {
    
    var searchvalue = document.getElementById("searchbox").value
    console.log(searchvalue);
    console.log("CONTACTING API");
    document.getElementById('Loading').innerHTML = "<h1>" + "Contacting API Please Wait..." + "</h1>";
    document.getElementById("searchbox").disabled = true;
    document.getElementById("results").innerHTML = "";


    var settings = {
    "async": true,
    "crossDomain": true,
    "url": "https://oak-partnership.co.uk/api/accounts?includeBalances=true",
    "method": "GET",
    "headers": {
      "Content-Type": "application/json",
      "Authorization": "Key ",
      "Cache-Control": "no-cache",
      "Postman-Token": "a271454e-be61-4193-908f-77cb6b94bb6c"
    },
    "processData": false,  
  } 

  $.ajax(settings).done(function (response) {
    document.getElementById("searchbox").disabled = false; 
    document.getElementById('Loading').innerHTML = '';

    for (var i = 0; i < response.length; i++) {
        console.log(response.length);

        var pointervalue = JSON.stringify(response[i]);

        if (pointervalue.includes(searchvalue)) {
            var StrResponse = JSON.stringify(response[i]);
            break;
        }
        else {}    
}

    var arr = StrResponse.split(",");
    for (var i = 0; i < arr.length; i++) {
        arr[i] = arr[i].replace(/"|accountCode|:|name|rewardPoints|dsp|bdf/g, "");

}
    var div = document.getElementById('results');

    var bdfvalue = parseFloat(arr[7]);
    bdfvalue = bdfvalue.toFixed(2);
    
    var dspvalue = parseInt(arr[6]);
    var rewards = parseInt(arr[5]);
    rewards = rewards.toFixed(0);

    text0 = document.createTextNode(arr[1]);
    text1 = document.createTextNode(arr[2]);
    text2 = document.createTextNode(rewards.toLocaleString("EUR"));
    text3 = document.createTextNode(dspvalue.toLocaleString("EUR"));
    text4 = document.createTextNode("£" + bdfvalue.toLocaleString("EUR"));
    var roundedre = rewards / 160 * 100 
    
    text5 = document.createTextNode(roundedre.toFixed(0) + ' (*exec overdraft)');
    text6 = document.createTextNode(checktv(dspvalue) + ' (*exec overdraft)');

      for (var i = 0; i < 7; i++){
    eval("p"+i+"=document.createElement('p')");
    eval('p'+i+".appendChild(text"+i+")");
    eval('div.appendChild(p'+i+')');
    }


    console.log(response);
    console.log(arr);
    return(response);

  });
}
</script>

<img id = "logo" src = "images/logo.png">

<div id = "middle">
<h1>Points Viewer (Beta)</h1>
<div class = "Customer Points">
<input id ="searchbox" type="text" name="search" placeholder="Account Code...">

    <script>
            document.getElementById('searchbox').addEventListener('keypress', function(event) {
                if (event.keyCode === 13) {
                    myFunction();
                }
            });

    </script>
    

<div id = "content">

<div id = "titles">
    <p>Account Code: </p>
    <p>Name: </p>
    <p>Rewards: </p>
    <p>DSP: </p>
    <p>BDF: </p>
    <P>Rewards to DSP:</p>
    <p>Digital Signage:</p>
</div>

<div id = "results">
    
</div>


</div>



</div>

<div id = "Loading"></div>

</div>


<div id = "bottom"> 

    <table id = "spreadsheet">
        <tr>
          <th>Account Code</th>
          <th>Name</th>
          <th>Rewards</th>
          <th>DSP</th>
          <th>BDF</th>
        
        </tr>
        <tr>
          <td>TBE</td>
          <td>T.B.E. Motor Services</td>
          <td>26380</td>
          <td>8,823</td>
          <td>£496.35</td>
        </tr> 
      </table>

</div>

<div id = "contact"><p>Please Report any bugs to: matthew.levin@oaktyres.co.uk</p></div>



</html> 